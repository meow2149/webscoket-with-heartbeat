var WebSocketWithHeartbeat=function(){"use strict";const e={heartbeatInterval:3e4,reconnectDelay:5e3,timeout:5e3,debug:!1};return class{options;url;webSocket=null;isManualClosed=!1;heartbeat={ping:"ping",pong:"pong"};heartbeatTimer;reconnectTimer;preCloseTimer;constructor(t,o){this.options={...e,...o},this.url=t.replace(/^http/,"ws"),this.connect()}connect(){this.cleanup(),this.webSocket=new WebSocket(this.url),this.webSocket.onopen=this.onOpen.bind(this),this.webSocket.onmessage=this.onMessage.bind(this),this.webSocket.onclose=this.onClose.bind(this),this.webSocket.onerror=this.onError.bind(this)}onopen=()=>{};onmessage=()=>{};onclose=()=>{};onerror=()=>{};send(e){this.webSocket?.readyState===WebSocket.OPEN&&(this.webSocket.send(e),this.debugLog("Message sent:",e))}close(){this.debugLog("Manual disconnection initiated."),this.isManualClosed=!0,this.cleanup()}onOpen(e){this.debugLog("Connection established."),this.onopen(e),this.startHeartbeat()}onMessage(e){this.debugLog("Message received:",e.data);JSON.parse(e.data).type===this.heartbeat.pong&&this.preCloseTimer?(this.debugLog("Heartbeat response received. Connection maintained."),clearTimeout(this.preCloseTimer),this.preCloseTimer=void 0):this.onmessage(e)}onClose(e){this.debugLog("Connection closed."),this.cleanup(),this.onclose(e),this.isManualClosed||this.reconnect()}onError(e){this.debugLog("An error occurred:",e),this.onerror(e)}startHeartbeat(){this.stopHeartbeat(),this.webSocket?.readyState===WebSocket.OPEN&&(this.heartbeatTimer=setInterval((()=>{this.sendHeartbeat()}),this.options.heartbeatInterval))}sendHeartbeat(){if(this.webSocket?.readyState===WebSocket.OPEN){const e=JSON.stringify({type:this.heartbeat.ping});this.webSocket.send(e),this.debugLog("Heartbeat sent:",e),this.preClose()}else this.stopHeartbeat()}stopHeartbeat(){clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0}reconnect(){this.stopReconnect(),this.reconnectTimer=setTimeout((()=>{this.debugLog("Attempting to reconnect..."),this.isManualClosed=!1,this.connect()}),this.options.reconnectDelay)}stopReconnect(){clearTimeout(this.reconnectTimer),this.reconnectTimer=void 0}preClose(){this.debugLog(`No heartbeat response. Closing connection in ${this.options.timeout}ms...`),this.preCloseTimer=setTimeout((()=>{this.webSocket?.close(),clearTimeout(this.preCloseTimer),this.preCloseTimer=void 0}),this.options.timeout)}cleanup(){this.stopHeartbeat(),this.stopReconnect(),this.preCloseTimer&&(clearTimeout(this.preCloseTimer),this.preCloseTimer=void 0),this.webSocket&&(this.webSocket.onopen=null,this.webSocket.onmessage=null,this.webSocket.onclose=null,this.webSocket.onerror=null,this.webSocket.readyState===WebSocket.OPEN&&this.webSocket.close(),this.webSocket=null)}debugLog(...e){this.options.debug&&console.log("%c WebSocketWithHeartbeat","background:#222;color:#ffd700;padding:4px;border-radius:5px;",...e)}}}();
