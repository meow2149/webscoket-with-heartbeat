var WebSocketWithHeartbeat=function(){"use strict";const e={heartbeatInterval:3e4,reconnectDelay:5e3,timeout:5e3,debug:!1,messageType:"json"};return class{#e;#t=!0;#s;#o=null;#i=!1;#n;#r;#a;constructor(t,s){this.#e={...e,...s},this.#s=t.replace(/^http/,"ws")}#c(){if(this.#o?.readyState===WebSocket.CONNECTING||this.#o?.readyState===WebSocket.OPEN)return;this.#h();const e=new WebSocket(this.#s);e.onopen=e=>this.#l(e),e.onmessage=e=>this.#b(e),e.onclose=e=>this.#d(e),e.onerror=e=>this.#p(e),this.#o=e}onopen=()=>{};onmessage=()=>{};onclose=()=>{};onerror=()=>{};send(e){if(this.#o?.readyState===WebSocket.OPEN){const t=JSON.stringify(e);if("binary"===this.#e.messageType){const e=new Blob([t],{type:"application/json"});this.#o.send(e)}else this.#o.send(t);this.#g("Message sent:",e)}}close(){this.#g("Manual disconnection initiated."),this.#i=!0,this.#h()}connect(){this.#i=!1,this.#c()}#l=e=>{this.#g("Connection established."),this.onopen(e),this.#u(),this.#S()};#b=async e=>{let t;if("binary"===this.#e.messageType){const s=e.data;t=await s.text()}else t=e.data;const s=JSON.parse(t);this.#g("Message received:",s),"pong"===s.type&&this.#a?(this.#g("Heartbeat response received. Connection maintained."),clearTimeout(this.#a),this.#a=void 0):this.onmessage(new MessageEvent("message",{data:s}))};#d=e=>{this.#g("Connection closed."),this.#h(),this.onclose(e),this.#i||this.#m()};#p=e=>{this.#g("An error occurred:",e),this.onerror(e),this.#o?.readyState===WebSocket.OPEN&&this.#o.close()};#S=()=>{this.#u(),this.#o?.readyState===WebSocket.OPEN&&this.#t&&(this.#k(),this.#n=setInterval((()=>{this.#k()}),this.#e.heartbeatInterval))};#k=()=>{if(this.#o?.readyState!==WebSocket.OPEN)return void this.#u();const e={type:"ping"},t=JSON.stringify(e);if("binary"===this.#e.messageType){const e=new Blob([t],{type:"application/json"});this.#o.send(e)}else this.#o.send(t);this.#g("Heartbeat sent:",e),this.#T()};#u=()=>{clearInterval(this.#n),this.#n=void 0};#m=()=>{this.#w(),this.#t&&(this.#r=setTimeout((()=>{this.#g("Attempting to reconnect..."),this.#i=!1,this.#c()}),this.#e.reconnectDelay))};#w=()=>{clearTimeout(this.#r),this.#r=void 0};#T=()=>{this.#g(`No heartbeat response. Closing connection in ${this.#e.timeout}ms...`),this.#a=setTimeout((()=>{this.#o?.close(),clearTimeout(this.#a),this.#a=void 0}),this.#e.timeout)};#h=()=>{this.#u(),this.#w(),this.#a&&(clearTimeout(this.#a),this.#a=void 0),this.#o&&(this.#o.onopen=null,this.#o.onmessage=null,this.#o.onclose=null,this.#o.onerror=null,this.#o.readyState===WebSocket.OPEN&&this.#o.close(),this.#o=null)};#g=(...e)=>{this.#e.debug&&console.log("%c WebSocketWithHeartbeat","background:#222;color:#ffd700;padding:4px;border-radius:4px;",...e)}}}();
